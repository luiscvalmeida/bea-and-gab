const translations = {
    en: {
        'nav.home': 'Main Page',
        'nav.accommodation': 'Accommodation',
        'nav.transport': 'Transport',
        'nav.rsvp': 'RSVP',
        'nav.kids': 'Kids',
        'nav.dresscode': 'Dress Code',
        'nav.gifts': 'Gifts',
        'main.title': 'Beatriz & Gabriel',
        'main.intro': 'We are very happy to celebrate this special day surrounded by the people we love.<br>We count on your presence to make this day even more special.',
        'main.location_title': 'Wedding Location:',
        'main.ceremony_title': 'Ceremony Time:',
        'main.time': '16:00 – The ceremony will begin, followed by a cocktail reception, dinner, and party.',
        'main.gmaps_btn': 'Open in Google Maps',
        'accom.title': 'Accommodation',
        'accom.intro': 'We’ve gathered a few suggestions for places to stay near the venue — with options to suit all budgets, from cozy spots for couples to larger accommodations for families and groups.',
        'accom.help': 'If you have any questions or need help finding the right place, please don\'t hesitate to get in touch with us. We\'ll be happy to help!',
        'accom.houses_title': 'Houses for groups:',
        'accom.hotels_title': 'Hotels/Guest Houses:',
        'accom.casa_da_eira_title': 'Casa da Eira',
        'accom.casa_da_eira_bedrooms': '2 Bedrooms',
        'accom.casa_da_eira_distance': '6 min drive from venue',
        'accom.casa_da_eira_breakfast': 'Breakfast included',
        'accom.bem_viver_title': 'Bem viver Country house',
        'accom.bem_viver_bedrooms': '4 bedrooms',
        'accom.bem_viver_distance': '3 min from venue',
        'accom.miragem_title': 'Miragem do Douro',
        'accom.miragem_distance': '10 min drive from venue',
        'accom.miragem_view': 'River View',
        'accom.stone_house_title': 'Stone House Entre os Rios',
        'accom.stone_house_bedrooms': '2 bedrooms',
        'accom.stone_house_view': 'River view',
        'accom.stone_house_distance': '16 min from venue',
        'accom.cancela_velha_title': 'Cancela Velha Guest House',
        'accom.cancela_velha_bedrooms': '3 bedrooms – 6 people',
        'accom.cancela_velha_location': 'Marco de Canaveses City center',
        'accom.cancela_velha_distance': '18 min car',
        'accom.canhoto_title': 'Canhoto Douro',
        'accom.canhoto_description': 'Guest house with 3 bedrooms, available to book separately.',
        'accom.canhoto_view': 'River View',
        'accom.canhoto_distance': '8 min from venue',
        'accom.dajas_title': 'Dajas Douro Valley Hotel',
        'accom.dajas_bride_groom': 'Accommodation of the bride and groom',
        'accom.dajas_view': 'Douro River view',
        'accom.dajas_breakfast': 'Breakfast included',
        'accom.dajas_transport': 'Transportation to and from the venue can be arranged by the hotel upon advance request.',
        'accom.dajas_distance': '15 min from venue',
        'accom.dajas_note': 'This is where the bride and groom will be staying.',
        'accom.host_wise_title': 'Host Wise Solar dos Pisoes',
        'accom.host_wise_description': '3 apartments, available to book separately.',
        'accom.host_wise_view': 'River view',
        'accom.host_wise_distance': '20 min from venue',
        'transport.title': 'Transport',
        'transport.intro': 'If you need transportation from the venue back to your hotel or home, please indicate this in your RSVP. We will arrange two shuttle departures for guests staying within a 20-minute radius of Quinta de Oleiros — one early and one late — depending on the number of people who need transport. This service is free.',
        'transport.early': 'The earlier we know who needs transport and where you are staying, the better service we can provide for everyone.',
        'transport.important_title': 'Important to note:',
        'transport.note1': 'The venue is located in a small town where Uber and other ride-sharing services are very limited and usually won\'t accept short trips, even if scheduled in advance.',
        'transport.note2': 'Parking: There is a parking lot available at the venue for guests who are driving.',
        'transport.note3': 'For transportation to the venue, if you\'re not driving, we recommend asking your hotel or host to help arrange a taxi or private transfer in advance.',
        'transport.note4': 'If you drink, don\'t drive - Streets can be narrow and dark in these small towns!',
        'transport.note5': 'For guests staying more than 20 minutes away from Quinta de Oleiros, please make sure to secure transportation back to your hotel.',
        'rsvp.title': 'RSVP',
        'rsvp.intro': 'Please let us know if you can make it by <strong>March 31st, 2026.</strong>',
        'rsvp.name_label': 'Name',
        'rsvp.name_placeholder': 'Your full name',
        'rsvp.plusone_label': 'Are you bringing a plus one?',
        'rsvp.plusone_placeholder': 'Name of your plus one (leave empty if none)',
        'rsvp.kids_label': 'Are you bringing kids/babies?',
        'rsvp.kids_yes': 'Yes',
        'rsvp.kids_no': 'No',
        'rsvp.kids_details_label': 'How many and what ages?',
        'rsvp.kids_details_placeholder': 'e.g., 2 kids (ages 3 and 7)',
        'rsvp.food_label': 'Do you have any food restrictions?',
        'rsvp.food_yes': 'Yes',
        'rsvp.food_no': 'No',
        'rsvp.food_details_label': 'If yes, which?',
        'rsvp.food_details_placeholder': 'Please describe your dietary restrictions',
        'rsvp.transport_label': 'Will you need transport back to your accommodation?',
        'rsvp.transport_description': 'We will be able to provide transport to places within a 20 mins range.',
        'rsvp.transport_yes': 'Yes',
        'rsvp.transport_no': 'No',
        'rsvp.transport_maybe': "Don't know yet",
        'rsvp.transport_details_label': 'If yes, please let us know at what time you would like that (before or after 1am) and where are you staying?',
        'rsvp.transport_details_placeholder': 'e.g., After 1am, staying at Hotel Dajas',
        'rsvp.submit': 'Submit',
        'rsvp.submitting': 'Submitting...',
        'rsvp.success': 'Thank you! Your RSVP has been received.',
        'rsvp.error': 'Something went wrong. Please try again or contact us directly.',
        'rsvp.required': 'This field is required',
        'kids.title': 'Kids & Babies',
        'kids.intro': 'We’re excited to celebrate with all our loved ones — and that includes the little ones! Kids and babies are more than welcome at our wedding.',
        'kids.note': 'Please make sure to indicate them in your RSVP, so we can plan accordingly and make the day fun and comfortable for guests of all ages.',
        'dresscode.title': 'Dress Code',
        'dresscode.intro': 'Our wedding will be outdoors, so we recommend semi-formal that’s also comfortable — perfect for dancing and enjoying the open-air celebration. Bring your dancing shoes!',
        'gifts.title': 'Gifts',
        'gifts.intro': 'Having you with us on our special day is the greatest gift!',
        'gifts.details': 'As we start our life together in Portugal, if you\'d like to share your best wishes and support, we will have a dedicated space at the venue where you can leave your kind contributions/donations to help us celebrate this new chapter.',
        'footer.quote': 'What if it was meant to be?'
    },
    fr: {
        'nav.home': 'Accueil',
        'nav.accommodation': 'Hébergement',
        'nav.transport': 'Transport',
        'nav.rsvp': 'RSVP',
        'nav.kids': 'Enfants',
        'nav.dresscode': 'Dress Code',
        'nav.gifts': 'Cadeaux',
        'main.title': 'Beatriz & Gabriel',
        'main.intro': 'Nous sommes ravis de célébrer ce jour spécial entourés des personnes que nous aimons.<br>Votre présence rendra notre mariage inoubliable.',
        'main.time': 'La cérémonie commencera à 16h.',
        'main.location_title': 'Lieu :',
        'main.gmaps_btn': 'Ouvrir dans Google Maps',
        'accom.title': 'Hébergement',
        'accom.intro': 'Nous avons rassemblé quelques suggestions d\'endroits où séjourner près du lieu — avec des options pour tous les budgets, des endroits confortables pour les couples aux plus grands hébergements pour les familles et les groupes.',
        'accom.help': 'Si vous avez des questions ou avez besoin d\'aide pour trouver le bon endroit, n\'hésitez pas à nous contacter. Nous serons heureux de vous aider!',
        'accom.houses_title': 'Maisons pour groupes :',
        'accom.hotels_title': 'Hôtels/Maisons d\'hôtes :',
        'accom.casa_da_eira_title': 'Casa da Eira',
        'accom.casa_da_eira_bedrooms': '2 chambres',
        'accom.casa_da_eira_distance': '6 min en voiture du lieu',
        'accom.casa_da_eira_breakfast': 'Petit-déjeuner inclus',
        'accom.bem_viver_title': 'Bem viver Country house',
        'accom.bem_viver_bedrooms': '4 chambres',
        'accom.bem_viver_distance': '3 min du lieu',
        'accom.miragem_title': 'Miragem do Douro',
        'accom.miragem_distance': '10 min en voiture du lieu',
        'accom.miragem_view': 'Vue sur la rivière',
        'accom.stone_house_title': 'Stone House Entre os Rios',
        'accom.stone_house_bedrooms': '2 chambres',
        'accom.stone_house_view': 'Vue sur la rivière',
        'accom.stone_house_distance': '16 min du lieu',
        'accom.cancela_velha_title': 'Cancela Velha Guest House',
        'accom.cancela_velha_bedrooms': '3 chambres – 6 personnes',
        'accom.cancela_velha_location': 'Centre-ville de Marco de Canaveses',
        'accom.cancela_velha_distance': '18 min en voiture',
        'accom.canhoto_title': 'Canhoto Douro',
        'accom.canhoto_description': 'Maison d\'hôtes avec 3 chambres, disponibles à réserver séparément.',
        'accom.canhoto_view': 'Vue sur la rivière',
        'accom.canhoto_distance': '8 min du lieu',
        'accom.dajas_title': 'Dajas Douro Valley Hotel',
        'accom.dajas_bride_groom': 'Hébergement des mariés',
        'accom.dajas_view': 'Vue sur la rivière Douro',
        'accom.dajas_breakfast': 'Petit-déjeuner inclus',
        'accom.dajas_transport': 'Le transport vers et depuis le lieu peut être organisé par l\'hôtel sur demande préalable.',
        'accom.dajas_distance': '15 min du lieu',
        'accom.dajas_note': 'C\'est là que les mariés séjourneront.',
        'accom.host_wise_title': 'Host Wise Solar dos Pisoes',
        'accom.host_wise_description': '3 appartements, disponibles à réserver séparément.',
        'accom.host_wise_view': 'Vue sur la rivière',
        'accom.host_wise_distance': '20 min du lieu',
        'transport.title': 'Transport',
        'transport.intro': 'Si vous avez besoin d\'un transport depuis le lieu jusqu\'à votre hôtel ou domicile, veuillez l\'indiquer dans votre RSVP. Nous organiserons deux départs de navette pour les invités séjournant dans un rayon de 20 minutes de Quinta de Oleiros — un tôt et un tard — en fonction du nombre de personnes ayant besoin de transport. Ce service est gratuit.',
        'transport.early': 'Plus tôt nous saurons qui a besoin de transport et où vous séjournez, meilleur sera le service que nous pourrons fournir à tous.',
        'transport.important_title': 'Important à noter :',
        'transport.note1': 'Le lieu est situé dans une petite ville où Uber et autres services de VTC sont très limités et n\'acceptent généralement pas les courts trajets, même réservés à l\'avance.',
        'transport.note2': 'Parking : Un parking est disponible sur place pour les invités qui viennent en voiture.',
        'transport.note3': 'Pour le transport vers le lieu, si vous ne conduisez pas, nous vous recommandons de demander à votre hôtel ou hôte d\'organiser un taxi ou un transfert privé à l\'avance.',
        'transport.note4': 'Si vous buvez, ne conduisez pas - Les routes peuvent être étroites et sombres dans ces petites villes!',
        'transport.note5': 'Pour les invités séjournant à plus de 20 minutes de Quinta de Oleiros, veuillez vous assurer d\'organiser votre transport retour vers votre hôtel.',
        'rsvp.title': 'RSVP',
        'rsvp.intro': 'Merci de nous faire savoir si vous pouvez venir avant le <strong>31 mars 2026.</strong>',
        'rsvp.name_label': 'Nom',
        'rsvp.name_placeholder': 'Votre nom complet',
        'rsvp.plusone_label': 'Amenez-vous quelqu\'un?',
        'rsvp.plusone_placeholder': 'Nom de votre accompagnant(e) (laissez vide si aucun)',
        'rsvp.kids_label': 'Amenez-vous des enfants/bébés?',
        'rsvp.kids_yes': 'Oui',
        'rsvp.kids_no': 'Non',
        'rsvp.kids_details_label': 'Combien et quel âge?',
        'rsvp.kids_details_placeholder': 'ex: 2 enfants (3 et 7 ans)',
        'rsvp.food_label': 'Avez-vous des restrictions alimentaires?',
        'rsvp.food_yes': 'Oui',
        'rsvp.food_no': 'Non',
        'rsvp.food_details_label': 'Si oui, lesquelles?',
        'rsvp.food_details_placeholder': 'Veuillez décrire vos restrictions alimentaires',
        'rsvp.transport_label': 'Aurez-vous besoin d\'un transport pour rentrer à votre hébergement?',
        'rsvp.transport_description': 'Nous pourrons fournir le transport vers des endroits dans un rayon de 20 minutes.',
        'rsvp.transport_yes': 'Oui',
        'rsvp.transport_no': 'Non',
        'rsvp.transport_maybe': 'Je ne sais pas encore',
        'rsvp.transport_details_label': 'Si oui, veuillez nous indiquer à quelle heure vous souhaiteriez partir (avant ou après 1h du matin) et où vous séjournez?',
        'rsvp.transport_details_placeholder': 'ex: Après 1h, à l\'hôtel Dajas',
        'rsvp.submit': 'Envoyer',
        'rsvp.submitting': 'Envoi en cours...',
        'rsvp.success': 'Merci! Votre RSVP a bien été reçu.',
        'rsvp.error': 'Une erreur s\'est produite. Veuillez réessayer ou nous contacter directement.',
        'rsvp.required': 'Ce champ est obligatoire',
        'kids.title': 'Enfants & Bébés',
        'kids.intro': 'Nous sommes ravis de célébrer avec tous nos proches — et cela inclut les tout-petits! Les enfants et les bébés sont les bienvenus à notre mariage.',
        'kids.note': 'Veuillez vous assurer de les indiquer dans votre RSVP, afin que nous puissions planifier en conséquence et rendre la journée amusante et confortable pour les invités de tous âges.',
        'dresscode.title': 'Dress Code',
        'dresscode.intro': 'Notre mariage se déroulera à l\'extérieur, nous recommandons donc une tenue semi-formelle mais confortable — parfaite pour danser et profiter de la soirée. Apportez vos chaussures de danse!',
        'gifts.title': 'Cadeaux',
        'gifts.intro': 'Vous avoir avec nous en ce jour spécial est le plus beau cadeau!',
        'gifts.details': 'Nous aurons un espace dédié où vous pourrez laisser vos aimables contributions/dons pour nous aider à célébrer ce nouveau chapitre, si vous souhaitez partager vos meilleurs vœux et votre soutien alors que nous commençons notre vie ensemble au Portugal.',
    },
    pt: {
        'nav.home': 'Início',
        'nav.accommodation': 'Alojamento',
        'nav.transport': 'Transporte',
        'nav.rsvp': 'RSVP',
        'nav.kids': 'Crianças',
        'nav.dresscode': 'Dress Code',
        'nav.gifts': 'Presentes',
        'main.title': 'Beatriz & Gabriel',
        'main.intro': 'Estamos muito felizes para celebrar este dia especial rodeados pelas pessoas que amamos.<br>Contamos com a vossa presença para tornar este dia ainda mais inesquecível.',
        'main.time': 'A cerimónia começará às 16h.',
        'main.location_title': 'Localização:',
        'main.gmaps_btn': 'Abrir no Google Maps',
        'accom.title': 'Alojamento',
        'accom.intro': 'Reunimos algumas sugestões de lugares para ficar perto do local — com opções para todos os orçamentos, desde lugares aconchegantes para casais até acomodações maiores para famílias e grupos.',
        'accom.help': 'Se tiverem alguma dúvida ou precisarem de ajuda para encontrar o lugar certo, não hesitem em entrar em contacto connosco. Teremos todo o gosto em ajudar!',
        'accom.houses_title': 'Casas para grupos:',
        'accom.hotels_title': 'Hotéis/Casas de hóspedes:',
        'accom.casa_da_eira_title': 'Casa da Eira',
        'accom.casa_da_eira_bedrooms': '2 quartos',
        'accom.casa_da_eira_distance': '6 min de carro do local',
        'accom.casa_da_eira_breakfast': 'Pequeno-almoço incluído',
        'accom.bem_viver_title': 'Bem viver Country house',
        'accom.bem_viver_bedrooms': '4 quartos',
        'accom.bem_viver_distance': '3 min do local',
        'accom.miragem_title': 'Miragem do Douro',
        'accom.miragem_distance': '10 min de carro do local',
        'accom.miragem_view': 'Vista para o rio',
        'accom.stone_house_title': 'Stone House Entre os Rios',
        'accom.stone_house_bedrooms': '2 quartos',
        'accom.stone_house_view': 'Vista para o rio',
        'accom.stone_house_distance': '16 min do local',
        'accom.cancela_velha_title': 'Cancela Velha Guest House',
        'accom.cancela_velha_bedrooms': '3 quartos – 6 pessoas',
        'accom.cancela_velha_location': 'Centro da cidade de Marco de Canaveses',
        'accom.cancela_velha_distance': '18 min de carro',
        'accom.canhoto_title': 'Canhoto Douro',
        'accom.canhoto_description': 'Casa de hóspedes com 3 quartos, disponíveis para reservar separadamente.',
        'accom.canhoto_view': 'Vista para o rio',
        'accom.canhoto_distance': '8 min do local',
        'accom.dajas_title': 'Dajas Douro Valley Hotel',
        'accom.dajas_bride_groom': 'Alojamento dos noivos',
        'accom.dajas_view': 'Vista para o rio Douro',
        'accom.dajas_breakfast': 'Pequeno-almoço incluído',
        'accom.dajas_transport': 'O transporte de e para o local pode ser organizado pelo hotel mediante pedido antecipado.',
        'accom.dajas_distance': '15 min do local',
        'accom.dajas_note': 'Este é o local onde os noivos ficarão.',
        'accom.host_wise_title': 'Host Wise Solar dos Pisoes',
        'accom.host_wise_description': '3 apartamentos, disponíveis para reservar separadamente.',
        'accom.host_wise_view': 'Vista para o rio',
        'accom.host_wise_distance': '20 min do local',
        'transport.title': 'Transporte',
        'transport.intro': 'Se precisarem de transporte do local de volta para o hotel ou casa, por favor indiquem no RSVP. Organizaremos duas partidas de shuttle para convidados hospedados num raio de 20 minutos da Quinta de Oleiros — uma cedo e outra tarde — dependendo do número de pessoas que precisem de transporte. Este serviço é gratuito.',
        'transport.early': 'Quanto mais cedo soubermos quem precisa de transporte e onde estão hospedados, melhor serviço poderemos fornecer a todos.',
        'transport.important_title': 'Importante notar:',
        'transport.note1': 'O local está situado numa pequena vila onde Uber e outros serviços de transporte são muito limitados e geralmente não aceitam viagens curtas, mesmo agendadas com antecedência.',
        'transport.note2': 'Estacionamento: Há um parque de estacionamento disponível no local para os convidados que vêm de carro.',
        'transport.note3': 'Para o transporte até ao local, se não forem de carro, recomendamos pedir ao vosso hotel ou anfitrião para ajudar a organizar um táxi ou transfer privado com antecedência.',
        'transport.note4': 'Se beberem, não conduzam - As estradas podem ser estreitas e escuras nestas pequenas vilas!',
        'transport.note5': 'Para convidados hospedados a mais de 20 minutos da Quinta de Oleiros, por favor garantam transporte de regresso ao vosso hotel.',
        'rsvp.title': 'RSVP',
        'rsvp.intro': 'Por favor, confirmem a vossa presença até <strong>31 de março de 2026.</strong>',
        'rsvp.name_label': 'Nome',
        'rsvp.name_placeholder': 'O seu nome completo',
        'rsvp.plusone_label': 'Vem acompanhado(a)?',
        'rsvp.plusone_placeholder': 'Nome do(a) acompanhante (deixe vazio se não)',
        'rsvp.kids_label': 'Traz crianças/bebés?',
        'rsvp.kids_yes': 'Sim',
        'rsvp.kids_no': 'Não',
        'rsvp.kids_details_label': 'Quantos e que idades?',
        'rsvp.kids_details_placeholder': 'ex: 2 crianças (3 e 7 anos)',
        'rsvp.food_label': 'Tem alguma restrição alimentar?',
        'rsvp.food_yes': 'Sim',
        'rsvp.food_no': 'Não',
        'rsvp.food_details_label': 'Se sim, quais?',
        'rsvp.food_details_placeholder': 'Por favor descreva as suas restrições alimentares',
        'rsvp.transport_label': 'Vai precisar de transporte de regresso ao alojamento?',
        'rsvp.transport_description': 'Poderemos fornecer transporte para locais num raio de 20 minutos.',
        'rsvp.transport_yes': 'Sim',
        'rsvp.transport_no': 'Não',
        'rsvp.transport_maybe': 'Ainda não sei',
        'rsvp.transport_details_label': 'Se sim, por favor indique a que horas gostaria (antes ou depois da 1h da manhã) e onde está hospedado?',
        'rsvp.transport_details_placeholder': 'ex: Depois da 1h, no Hotel Dajas',
        'rsvp.submit': 'Enviar',
        'rsvp.submitting': 'A enviar...',
        'rsvp.success': 'Obrigado! A sua confirmação foi recebida.',
        'rsvp.error': 'Ocorreu um erro. Por favor tente novamente ou contacte-nos diretamente.',
        'rsvp.required': 'Este campo é obrigatório',
        'kids.title': 'Crianças & Bebés',
        'kids.intro': 'Estamos animados para celebrar com todos os nossos amigos e família — e isso inclui os mais pequenos! Crianças e bebés são muito bem-vindos ao nosso casamento.',
        'kids.note': 'Por favor, certifiquem-se de indicá-los no vosso RSVP, para que possamos planear de acordo e tornar o dia divertido e confortável para convidados de todas as idades.',
        'dresscode.title': 'Dress Code',
        'dresscode.intro': 'O nosso casamento será ao ar livre, por isso recomendamos um dress code semi-formal que seja também confortável — perfeito para aproveitar a celebracao. Tragam os vossos melhores sapatos para dançar! :)',
        'gifts.title': 'Presentes',
        'gifts.intro': 'Ter-vos connosco no nosso dia especial é o maior presente!',
        'gifts.details': 'Ao iniciarmos a nossa vida juntos em Portugal, se quiserem partilhar os vossos melhores votos e apoio, teremos um espaço dedicado no local onde poderão deixar as vossas amáveis contribuições/donativos para nos ajudar a começar este novo capítulo.',
    }
};

function setLanguage(lang) {
    // Update active button
    document.querySelectorAll('.lang-switcher button, .mobile-lang-switcher button').forEach(btn => {
        btn.classList.remove('active');
        if (btn.textContent.toLowerCase() === lang) {
            btn.classList.add('active');
        }
    });

    // Update text content
    document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        if (translations[lang] && translations[lang][key]) {
            element.innerHTML = translations[lang][key];
        }
    });

    // Update placeholders
    document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
        const key = element.getAttribute('data-i18n-placeholder');
        if (translations[lang] && translations[lang][key]) {
            element.placeholder = translations[lang][key];
        }
    });

    // Update body class
    document.body.className = `lang-${lang}`;
}

// Mobile Menu Toggle
function toggleMenu() {
    const menu = document.querySelector('.mobile-menu');
    menu.classList.toggle('active');
}

document.querySelector('.hamburger').addEventListener('click', toggleMenu);

// Initialize with default language on page load
setLanguage('en');

// Close mobile menu when clicking a link
document.querySelectorAll('.mobile-menu a').forEach(link => {
    link.addEventListener('click', () => {
        document.querySelector('.mobile-menu').classList.remove('active');
    });
});

// RSVP Form Handling
const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzLr1TSqLQRAQNUf3pP-NvyUnwzlMqlQXmFGqx0ZwnHw5DNQwnKOwPy77VDydufPWVg/exec';
const RSVP_STORAGE_KEY = 'rsvp_submitted';

function initRSVPForm() {
    const form = document.getElementById('rsvp-form');
    if (!form) return;

    const successMsg = document.getElementById('rsvp-success');

    // Check if already submitted
    if (localStorage.getItem(RSVP_STORAGE_KEY)) {
        form.style.display = 'none';
        successMsg.style.display = 'block';
        return;
    }

    // Conditional field visibility
    const kidsRadios = document.querySelectorAll('input[name="bringingKids"]');
    const kidsDetailsGroup = document.getElementById('kids-details-group');

    const foodRadios = document.querySelectorAll('input[name="foodRestrictions"]');
    const foodDetailsGroup = document.getElementById('food-details-group');

    const transportRadios = document.querySelectorAll('input[name="needTransport"]');
    const transportDetailsGroup = document.getElementById('transport-details-group');

    kidsRadios.forEach(radio => {
        radio.addEventListener('change', () => {
            kidsDetailsGroup.classList.toggle('visible', radio.value === 'yes' && radio.checked);
        });
    });

    foodRadios.forEach(radio => {
        radio.addEventListener('change', () => {
            foodDetailsGroup.classList.toggle('visible', radio.value === 'yes' && radio.checked);
        });
    });

    transportRadios.forEach(radio => {
        radio.addEventListener('change', () => {
            transportDetailsGroup.classList.toggle('visible', radio.value === 'yes' && radio.checked);
        });
    });

    // Form submission
    form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const submitBtn = document.getElementById('rsvp-submit');
        const successMsg = document.getElementById('rsvp-success');
        const errorMsg = document.getElementById('rsvp-error');

        // Get current language for button text
        const currentLang = document.body.className.replace('lang-', '') || 'en';
        const submittingText = translations[currentLang]['rsvp.submitting'];
        const submitText = translations[currentLang]['rsvp.submit'];

        // Disable button and show loading state
        submitBtn.disabled = true;
        submitBtn.textContent = submittingText;
        successMsg.style.display = 'none';
        errorMsg.style.display = 'none';

        // Collect form data
        const formData = {
            name: form.querySelector('[name="name"]').value,
            plusOne: form.querySelector('[name="plusOne"]').value,
            bringingKids: form.querySelector('[name="bringingKids"]:checked')?.value || '',
            kidsDetails: form.querySelector('[name="kidsDetails"]').value,
            foodRestrictions: form.querySelector('[name="foodRestrictions"]:checked')?.value || '',
            foodDetails: form.querySelector('[name="foodDetails"]').value,
            needTransport: form.querySelector('[name="needTransport"]:checked')?.value || '',
            transportDetails: form.querySelector('[name="transportDetails"]').value,
            language: currentLang,
            submittedAt: new Date().toISOString()
        };

        try {
            const response = await fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            });

            // With no-cors mode, we can't read the response, so we assume success
            localStorage.setItem(RSVP_STORAGE_KEY, JSON.stringify({
                name: formData.name,
                submittedAt: formData.submittedAt
            }));

            form.style.display = 'none';
            successMsg.style.display = 'block';

            // Scroll to success message
            successMsg.scrollIntoView({ behavior: 'smooth', block: 'center' });

        } catch (error) {
            console.error('Form submission error:', error);
            errorMsg.style.display = 'block';
        } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = submitText;
        }
    });
}

// Initialize form when DOM is ready
document.addEventListener('DOMContentLoaded', initRSVPForm);
